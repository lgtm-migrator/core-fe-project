{"version":3,"file":"async.js","sourceRoot":"","sources":["../../src/util/async.tsx"],"names":[],"mappings":";AAAA,OAAO,KAAK,MAAM,OAAO,CAAC;AAC1B,OAAO,EAAC,GAAG,EAAC,MAAM,QAAQ,CAAC;AAC3B,OAAO,EAAC,aAAa,EAAC,MAAM,YAAY,CAAC;AACzC,OAAO,EAAC,YAAY,EAAC,MAAM,cAAc,CAAC;AAoB1C,MAAM,UAAU,KAAK,CAAsC,OAAyB,EAAE,SAAY,EAAE,EAAwE;QAAxE,qBAAsE,EAAE,KAAA,EAAvE,gBAAgB,sBAAA,EAAE,iBAAiB,uBAAA,EAAE,cAAc,oBAAA;IACpJ,OAAO;QAAoC,yCAA8C;QACrF,+BAAY,KAAS;YAArB,YACI,kBAAM,KAAK,CAAC,SAEf;YAMD,mBAAa,GAAG;;;;;;4BAER,IAAI,CAAC,QAAQ,CAAC,EAAC,KAAK,EAAE,IAAI,EAAC,CAAC,CAAC;4BAC7B,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,iBAAiB,CAAC,CAAC,CAAC;4BACrC,qBAAM,OAAO,EAAE,EAAA;;4BAA/B,aAAa,GAAG,SAAe;4BACrC,IAAI,CAAC,QAAQ,CAAC,EAAC,SAAS,EAAE,aAAa,CAAC,SAAS,CAAQ,EAAC,CAAC,CAAC;;;;4BAE5D,YAAY,CAAC,GAAC,EAAE,0BAA0B,CAAC,CAAC;4BAC5C,IAAI,CAAC,QAAQ,CAAC,EAAC,KAAK,EAAE,GAAC,EAAC,CAAC,CAAC;;;4BAE1B,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,EAAE,iBAAiB,CAAC,CAAC,CAAC;;;;;iBAEnE,CAAC;YAnBE,KAAI,CAAC,KAAK,GAAG,EAAC,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAC,CAAC;;QAChD,CAAC;QAEQ,iDAAiB,GAA1B;YACI,IAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC;QAgBQ,sCAAM,GAAf;YACU,IAAA,KAAqB,IAAI,CAAC,KAAK,EAA9B,SAAS,eAAA,EAAE,KAAK,WAAc,CAAC;YACtC,IAAM,QAAQ,GAAG,KAAK,KAAK,IAAI,CAAC;YAEhC,IAAI,QAAQ,EAAE;gBACV,OAAO,cAAc,CAAC,CAAC,CAAC,oBAAC,cAAc,IAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,CAAC,aAAa,GAAI,CAAC,CAAC,CAAC,IAAI,CAAC;aAC/F;YAED,OAAO,SAAS,CAAC,CAAC,CAAC,oBAAC,SAAS,eAAK,IAAI,CAAC,KAAK,EAAI,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,oBAAC,gBAAgB,OAAG,CAAC,CAAC,CAAC,IAAI,CAAC;QACtG,CAAC;QACL,4BAAC;IAAD,CAAC,AAlCM,CAAoC,KAAK,CAAC,aAAa,EAkCtD,CAAC;AACb,CAAC","sourcesContent":["import React from \"react\";\nimport {app} from \"../app\";\nimport {loadingAction} from \"../reducer\";\nimport {captureError} from \"./error-util\";\n\ntype ReactComponentKeyOf<T> = {[P in keyof T]: T[P] extends React.ComponentType<any> ? P : never}[keyof T];\n\nexport interface AsyncOptions {\n    loadingIdentifier?: string;\n    LoadingComponent?: React.ComponentType;\n    ErrorComponent?: React.ComponentType<AsyncErrorComponentProps>;\n}\n\nexport interface AsyncErrorComponentProps {\n    error: unknown;\n    reload: () => Promise<void>;\n}\n\ninterface WrapperComponentState {\n    Component: React.ComponentType<any> | null;\n    error: unknown | null;\n}\n\nexport function async<T, K extends ReactComponentKeyOf<T>>(resolve: () => Promise<T>, component: K, {LoadingComponent, loadingIdentifier, ErrorComponent}: AsyncOptions = {}): T[K] {\n    return class AsyncWrapperComponent extends React.PureComponent<{}, WrapperComponentState> {\n        constructor(props: {}) {\n            super(props);\n            this.state = {Component: null, error: null};\n        }\n\n        override componentDidMount() {\n            this.loadComponent();\n        }\n\n        loadComponent = async () => {\n            try {\n                this.setState({error: null});\n                app.store.dispatch(loadingAction(true, loadingIdentifier));\n                const moduleExports = await resolve();\n                this.setState({Component: moduleExports[component] as any});\n            } catch (e) {\n                captureError(e, \"@@framework/async-import\");\n                this.setState({error: e});\n            } finally {\n                app.store.dispatch(loadingAction(false, loadingIdentifier));\n            }\n        };\n\n        override render() {\n            const {Component, error} = this.state;\n            const hasError = error !== null;\n\n            if (hasError) {\n                return ErrorComponent ? <ErrorComponent error={error} reload={this.loadComponent} /> : null;\n            }\n\n            return Component ? <Component {...this.props} /> : LoadingComponent ? <LoadingComponent /> : null;\n        }\n    } as any;\n}\n"]}