{"version":3,"file":"RetryOnNetworkConnectionError.js","sourceRoot":"","sources":["../../src/decorator/RetryOnNetworkConnectionError.ts"],"names":[],"mappings":";AAAA,OAAO,EAAC,GAAG,EAAC,MAAM,QAAQ,CAAC;AAC3B,OAAO,EAAC,0BAA0B,EAAC,MAAM,cAAc,CAAC;AACxD,OAAO,EAAC,KAAK,EAAC,MAAM,oBAAoB,CAAC;AACzC,OAAO,EAAC,4BAA4B,EAAC,MAAM,SAAS,CAAC;AAErD;;;GAGG;AACH,MAAM,UAAU,6BAA6B,CAAC,mBAA+B;IAA/B,oCAAA,EAAA,uBAA+B;IACzE,OAAO,4BAA4B,CAAC,UAAW,OAAO;;;;;oBAC9C,SAAS,GAAG,CAAC,CAAC;;;yBACX,IAAI;;;;oBAEH,sBAAA,SAAO,OAAO,EAAE,CAAA,EAAA;;oBAAhB,SAAgB,CAAC;oBACjB,wBAAM;;;yBAEF,CAAA,GAAC,YAAY,0BAA0B,CAAA,EAAvC,wBAAuC;oBACvC,SAAS,EAAE,CAAC;oBACZ,GAAG,CAAC,MAAM,CAAC,SAAS,CAChB,GAAC,EACD;wBACI,OAAO,EAAE,OAAO,CAAC,YAAY;wBAC7B,cAAc,EAAE,sBAAe,SAAS,CAAE;qBAC7C,EACD,OAAO,CAAC,UAAU,CACrB,CAAC;oBACF,qBAAM,KAAK,CAAC,mBAAmB,GAAG,IAAI,CAAC,EAAA;;oBAAvC,SAAuC,CAAC;;wBAExC,MAAM,GAAC,CAAC;;;;;;KAIvB,CAAC,CAAC;AACP,CAAC","sourcesContent":["import {app} from \"../app\";\nimport {NetworkConnectionException} from \"../Exception\";\nimport {delay} from \"redux-saga/effects\";\nimport {createActionHandlerDecorator} from \"./index\";\n\n/**\n * Re-execute the action if NetworkConnectionException is thrown.\n * A warning log will be also created, for each retry.\n */\nexport function RetryOnNetworkConnectionError(retryIntervalSecond: number = 3) {\n    return createActionHandlerDecorator(function* (handler) {\n        let retryTime = 0;\n        while (true) {\n            try {\n                yield* handler();\n                break;\n            } catch (e) {\n                if (e instanceof NetworkConnectionException) {\n                    retryTime++;\n                    app.logger.exception(\n                        e,\n                        {\n                            payload: handler.maskedParams,\n                            process_method: `will retry #${retryTime}`,\n                        },\n                        handler.actionName\n                    );\n                    yield delay(retryIntervalSecond * 1000);\n                } else {\n                    throw e;\n                }\n            }\n        }\n    });\n}\n"]}